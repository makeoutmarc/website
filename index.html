<!DOCTYPE html> <!-- HTML5 Dokumenttyp -->
<html lang="de"> <!-- Sprache der Website = Deutsch -->
<head>
    <script>
        const theme = localStorage.getItem("theme");
        if (theme === "dark") {
            document.documentElement.classList.add("dark");
        }
    </script>

<meta charset="UTF-8"> <!-- Zeichencodierung -->
<meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Mobile Optimierung -->
<title>Meal Planner</title> <!-- Titel im Browser-Tab -->


<style>

/* =========================
   GRUNDLAYOUT
========================= */

:root {
    --bg: #f5f7fa;
    --card: #ffffff;
    --text: #111827;
    --muted: #6b7280;
    --border: #cbd5e1;
}

body {
    font-family: Arial, sans-serif;
    
    background-color: #0f1115;
    background-image:
        radial-gradient(circle at 20% 20%, rgba(0,180,75,0.15), transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(0,180,75,0.10), transparent 40%);
    
    background-repeat: no-repeat;
    background-attachment: fixed;
    
    color: var(--text);
    display: flex;
    justify-content: center;
    padding: 40px 20px;
    min-height: 100vh;
    transition: background 0.3s ease, color 0.3s ease;
}

/* Hauptcontainer */
.container {
    background: var(--card);
    padding: 30px;  /* Innenabstand */
    width: 100%;
    max-width: 1000px;
    border-radius: 12px;    /* Abgerundete Ecken */
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);    /* Schatten */
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}

/* √úberschrift */
h1 {
    margin-bottom: 20px; /* Abstand nach unten */
}

/* Eingabefeld */
input {
  width: 100%;
  height: 48px;
  padding: 0 12px;
  font-size: 16px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--card);
  color: var(--text);
  margin-bottom: 15px;
  box-sizing: border-box;
  transition: background 0.3s ease, color 0.3s ease, border 0.3s ease;
}

input::placeholder {
  color: var(--muted);
}



/* Buttons allgemein */
button {
    padding: 10px; /* Innenabstand */
    border: none; /* Kein Rahmen */
    border-radius: 6px; /* Runde Ecken */
    cursor: pointer; /* Mauszeiger = Hand */
    font-weight: bold; /* Fettschrift */
    transition: 0.2s ease; /* Hover-Animation */
}




/* Hinzuf√ºgen Button */
.add-btn {
    background: #00b44b; /* Gr√ºn */
    color: white; /* Textfarbe */
    width: 100%; /* Volle Breite */
    margin-bottom: 15px; /* Abstand */
    font-weight: bold;
    font-size: 16px;
}

.add-btn:hover {
    background: #27ae60; /* Dunkleres Gr√ºn bei Hover */
}

/* Zufalls Button */
.random-btn {
    background: #00b44b;
    color: white;
    width: 100%;
    margin-top: 15px;
    font-weight: 600;
    font-size: 16px;
    margin-bottom: 15px;
    border-radius: 10px;
    transition: all 0.2s ease;
}

.random-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 18px rgba(0,0,0,0.2);
}

.day-row {
    display: flex;
    align-items: center;
    gap: 12px;

    background: var(--card);
    border: 1px solid var(--border);
    box-shadow: 0 1px 4px rgba(0,0,0,0.05);
    padding: 12px 14px;
    border-radius: 10px;
    margin-bottom: 12px;

    transition: all 0.2s ease;
}

.day-row:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.06);
    background: #f3f4f6; /* Light Mode */
}

body.dark .day-row:hover {
    background: #22262d;
}

.day-row.filled {
    border-left: 5px solid #00b44b;
    background: #f0fdf4; /* Light Mode */
}

.day-row span {
    flex: 1;
}

.day-row button {
    width: 30px;
    height: 30px;
    padding: 0;
    font-size: 14px;
}

.section-divider {
    margin: 30px 0;
    border: none;
    height: 1px;
    background: rgba(0,0,0,0.15);
}



/* Liste */

ul {
    list-style: none;
    padding: 0;
    margin: 0;

    column-gap: 40px;      /* Abstand */
}

/* Einzelnes Essen */
.food-item {
    background: var(--card);
    border: 1px solid var(--border);
    box-shadow: 0 2px 6px rgba(0,0,0,0.06);
    padding: 12px 14px;
    margin-bottom: 12px;
    border-radius: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    break-inside: avoid;
    box-shadow: 0 2px 6px rgba(0,0,0,0.04);
    transition: all 0.2s ease;
}

.food-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.08);
    background: #f3f4f6; /* Light Mode Hover */
}

/* Entfernen Button */
.remove-btn {
    background: transparent;
    color: #646464;
    width: 28px;
    height: 28px;
    border-radius: 8px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 16px;
    transition: all 0.2s ease;
}

.remove-btn:hover {
    background: #fee2e2;
    color: #dc2626;
    transform: scale(1.1);
}

.grid-container {
    display: grid;
    grid-template-columns: 1fr 1fr; /* 2 Spalten mit gleicher Breite */
    gap: 40px;
}

.column {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.letter-heading {
    margin-top: 15px;
}

/* Zufallsergebnis */
#result {
    font-size: 16px; /* Gro√üe Schrift */
    font-weight: bold;
    margin-top: 15px;
}

#foodList {
    display: grid;
    grid-template-columns: 1fr 1fr; /* 2 Spalten mit gleicher Breite */
    gap: 40px;
}

#weekPlan {
    margin-top: 15px;
}

.column {
    display: flex;
    flex-direction: column;
}

.reset-btn {
    background: transparent;
    border: none;
    color: #ef4444;
    font-size: 14px;
    font-weight: 500;
    padding: 6px 0;
    cursor: pointer;
}

.reset-btn:hover {
    text-decoration: underline;
}

/* ================= SHARE MODAL ================= */

/* Hintergrund des Modals */
/* Modal = kleines Fenster, das √ºber der Seite liegt, um z.B. Informationen anzuzeigen oder Aktionen durchzuf√ºhren */
.share-modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.4);
    justify-content: center;
    align-items: center;
    z-index: 1000;
    
}

/* Wei√ües K√§stchen im Modal */
.share-box {
    background: white;
    width: 500px;
    max-width: 90%;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    margin-top: 15px;
}

/* Tabs im Modal (z.B. f√ºr Link kopieren, QR Code, etc.) */
.share-tabs {
    border-bottom: 1px solid #ddd;
    margin-bottom: 15px;
}

/* Aktiver Tab */
.active-tab {
    font-weight: bold;
    padding-bottom: 8px;
    border-bottom: 3px solid #f4b400;
    display: inline-block;
}

/* Zeile mit Eingabefeld und Kopieren-Button */
.share-input-row {
    display: flex;
    gap: 10px;
    margin-top: 10px;
    height: auto;
}

/* Eingabefeld im Modal */
.copy-btn {
    background: #f4b400;
    color: black;
    white-space: nowrap;
}

/* Einfacher Hover-Effekt f√ºr den Kopieren-Button */
/* Hover = wenn Maus √ºber dem Button ist */
.copy-btn:hover {
    background: #e2a800;
}

/* Schlie√üen Button */
.close-btn {
    margin-top: 15px;
    background: #ccc;
}

/* Einfacher Hover-Effekt f√ºr den Schlie√üen-Button */
.close-btn:hover {
    background: #bbb;
}

/* ================= TOAST ================= (TOAST = kleine Benachrichtigung, die kurz aufpoppt) */
.toast {
    position: fixed;                                   /* Immer sichtbar, auch beim Scrollen */
    bottom: 30px;                                   /* Abstand vom unteren Rand */
    left: 50%;                                      /* Horizontal zentrieren */
    transform: translateX(-50%) translateY(20px);   /* Startet leicht unterhalb der Mitte */
    background: rgba(0,0,0,0.85);                 /* Heller Hintergrund mit Transparenz */
    backdrop-filter: blur(6px);                     /* Weiche Unsch√§rfe f√ºr den Hintergrund */
    color: rgb(0, 0, 0);                          /* Dunkle Schriftfarbe */
    padding: 14px 22px;                             /* Innenabstand */
    border-radius: 12px;                            /* Runde Ecken */
    font-size: 20px;                                /* Gr√∂√üere Schrift */
    opacity: 0;                                     /* Unsichtbar am Anfang */
    transition: all 0.3s ease;                      /* Weiche Animation f√ºr Ein- und Ausblenden */
    z-index: 2000; 
    box-shadow: 0 10px 25px rgba(0,0,0,0.25); /* Schatten f√ºr 3D-Effekt */
}

/* Wenn die Klasse "show" hinzugef√ºgt wird, wird der Toast sichtbar und bewegt sich leicht nach oben */
.toast.show { 
    opacity: 1;
    transform: translateX(-50%) translateY(0);
}

/* Unterschiedliche Hintergrundfarben f√ºr Erfolg und Fehler */
.toast.success {
    background: #ffffff;
}

/* Fehler-Toast mit rotem Hintergrund */
.toast.error {
    background: #e74c3c;
}

/* ================= ADD ROW (Input + Plus Button) ================= */

.add-row {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}

.add-row input {
    flex: 1;
    margin-bottom: 0;
}

.add-icon-btn {
    width: 50px;
    background: #00b44b;
    color: white;
    font-size: 22px;
    border-radius: 8px;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: 0.2s ease;
    height: 48px;     /* gleiche H√∂he wie Input */
}

.add-icon-btn:hover {
    background: #27ae60;
    transform: scale(1.05);
}

/* ================= TABS ================= */

/* ================= MODERN TABS ================= */

.tabs {
    display: inline-flex;
    background: var(--card);
    padding: 6px;
    border-radius: 14px;
    gap: 4px;
    margin-bottom: 0px;
    border: 1px solid var(--border);
}

/* Wrapper um die Tabs, um den unteren Rand zu gestalten */
.tabs-wrapper { 
    border-bottom: 2px solid #000000;
    padding-bottom: 12px;
    margin-bottom: 18px;
}

.tab {
    background: transparent;
    border: none;
    padding: 8px 18px;
    font-size: 14px;
    cursor: pointer;
    color: var(--muted);
    border-radius: 10px;
    font-weight: 500;
    transition: all 0.25s ease;
}

.tab:hover {
    background: rgba(0,0,0,0.05);
}

.tab.active {
    background: #00b44b;
    color: white;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(0,180,75,0.3);
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

/* ================= TOP BAR ================= */

.top-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.top-bar h1 {
    margin: 0;
}

.share-top-btn {
    background: #f0fdf4;
    color: #059669;
    padding: 10px 18px;              /* etwas mehr Luft */
    font-size: 14px;
    border-radius: 14px;             /* weicher */
    font-weight: 600;
    border: 1px solid #d1fae5;
    box-shadow: 0 2px 6px rgba(0,0,0,0.04);   /* ganz leichter Grundschatten */
    transition: all 0.2s ease;
}

.share-top-btn:hover {
    background: #00b44b;
    color: white;
    transform: translateY(-1px);     /* weniger aggressiv */
    box-shadow: 0 8px 18px rgba(0,0,0,0.08);
}

/* ================= LETTER HEADINGS ================= */

.letter-heading {
    margin: 20px 0 10px 0;
}

.letter-label {
    font-size: 15px;
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
    opacity: 0.7;
    margin: 25px 0 10px 0;
    position: relative;
    padding-bottom: 6px;
}

.letter-label::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: 0;
    width: 100%;
    height: 1px;
    background: var(--border);
}

/* ================= WEEKPLAN MODERN ================= */

.day-left {
    display: flex;
    flex-direction: column;
    flex: 1;
}

.day-name {
    font-size: 13px;
    font-weight: 600;
    color: var(--muted);
    margin-bottom: 3px;
}

.day-meal {
    font-size: 16px;
    font-weight: 500;
    color: var(--text);
}

.dice-btn {
    background: #e5e7eb;
    border-radius: 8px;
    width: 38px;
    height: 38px;
    font-size: 16px;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.dice-btn.spin {
    animation: diceSpin 0.4s ease;
}

@keyframes diceSpin {
    0%   { transform: rotate(0deg) scale(1); }
    50%  { transform: rotate(180deg) scale(1.2); }
    100% { transform: rotate(360deg) scale(1); }
}

.dice-btn:hover {
    background: #00b44b;
    color: white;
    transform: scale(1.05);
}

.empty-meal {
    color: #9ca3af;
    font-style: italic;
}

/* ================= MEAL COUNT ================= */

.meal-count {
    font-size: 14px;
    color: #6b7280;
    margin-bottom: 20px;
    font-weight: 500;
}

/* ================= TAB BADGE ================= */

.tab-badge {
    display: inline-block;          /* WICHTIG */
    background: #e5e7eb;
    color: #374151;
    font-size: 12px;
    font-weight: 600;
    padding: 2px 7px;
    font-size: 11px;
    border-radius: 20px;
    margin-left: 6px;
    transform-origin: center;       /* sauberer Scale */
}

.tab-badge.bump {
    animation: bump 0.4s ease;
}

@keyframes bump {
    0%   { transform: scale(1); }
    50%  { transform: scale(1.45); }
    100% { transform: scale(1); }
}

.tab.active .tab-badge {
    background: #00b44b;
    color: white;
}

body.dark {
    --bg: #0f1115;
    background:
        radial-gradient(circle at 20% 20%, rgba(0,180,75,0.12), transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(0,180,75,0.08), transparent 40%),
        #0f1115;
    --card: #1a1d23;
    --text: #f1f5f9;
    --muted: #9aa4b2;
    --border: #2a2f36;
}

body.dark .tabs {
    background: #15181d;
    border: 1px solid #2a2f36;
}

body.dark .tab:hover {
    background: rgba(255,255,255,0.06);
}

body.dark .day-row.filled {
    background: #1f2a22;   /* dunkles, ents√§ttigtes Gr√ºn */
    border-left: 5px solid #00b44b;
}

body.dark .day-row.filled .day-name {
    color: #9fb8a8; /* leicht gr√ºnlich ged√§mpft */
}

body.dark .day-row.filled {
    color: #e6f4ea; /* helles Gr√ºn statt reines Wei√ü */
}

body.dark .food-item:hover {
    background: #22262d;
}

body.dark .tab-badge {
    background: #2a2f36;
    color: #cbd5e1;
}

body.dark .tab.active .tab-badge {
    background: #00b44b;
    color: white;
}

body.dark .reset-btn {
    color: #f87171;
}

body.dark .reset-btn:hover {
    background: #ef4444;
    color: white;
}

body.dark .tabs-wrapper {
    border-bottom: 2px solid #ffffff;
}

body.dark .letter-label::after {
    background: #3a4048;
}

body.dark .remove-btn {
    color: #ffffff;
}

#weekView .reset-btn {
    display: block;
    margin-left: auto;
    margin-top: 20px;
}

@media (max-width: 600px) {
    .container {
        padding: 20px;
    }
}



</style>
</head>

<body>

<div id="toast" class="toast"></div>

<div class="container">

    <div class="top-bar">
    <h1>Meal Planner</h1>

    <div style="display:flex; gap:10px; align-items:center;">
        <button id="themeToggle" class="share-top-btn">üåô</button>
        <button class="share-top-btn" onclick="sharePlan()">Teilen</button>
    </div>
    </div>

    <!-- TABS -->
    <div class="tabs-wrapper">
        <div class="tabs">
        <button class="tab active" onclick="switchTab('meals')">
            Gerichte <span id="mealCountBadge" class="tab-badge">0</span>
        </button>
        <button class="tab" onclick="switchTab('week')">
            Wochenplan <span id="weekCountBadge" class="tab-badge">0/7</span>
        </button>
        </div>
    </div>

    <!-- GERICHETE VIEW -->
    <div id="mealsView" class="tab-content active">

    <div class="add-row">
        <input type="text" id="foodInput" placeholder="Neues Gericht hinzuf√ºgen...">
        <button class="add-icon-btn" onclick="addFood()">+</button>
    </div>

    <input type="text" id="searchInput" placeholder="Gericht suchen...">

    <div id="foodList"></div>

    <button class="random-btn" onclick="pickRandomFood()">Zuf√§lliges Gericht ausw√§hlen</button>

    <div id="result"></div>

</div>

    <!-- WOCHENPLAN VIEW -->
    <div id="weekView" class="tab-content">

        
        <div id="weekPlan"></div>
        <button class="reset-btn" onclick="resetWeekPlan()">Woche zur√ºcksetzen</button>

    </div>

</div>

<script type="module"> 

// Firebase Imports (Module aus Firebase laden)
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { 
    getFirestore,
    collection,
    addDoc,
    deleteDoc,
    doc,
    onSnapshot,
    setDoc,
    getDoc
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

// Firebase Config (Verbindungsdaten zu deinem Projekt)
const firebaseConfig = {
    apiKey: "AIza...",
    authDomain: "website-essen.firebaseapp.com",
    projectId: "website-essen",
    storageBucket: "website-essen.firebasestorage.app",
    messagingSenderId: "95662683991",
    appId: "1:95662683991:web:0bc5891b804db149647012"
};

// Firebase starten
const app = initializeApp(firebaseConfig); // App initialisieren
const db = getFirestore(app); // Firestore Datenbank starten

// ================= PLAN-ID LOGIK =================

// ================= PLAN-ID LOGIK =================

// URL Parameter lesen
const urlParams = new URLSearchParams(window.location.search);
let planId = urlParams.get("plan");

// Wenn kein Plan existiert ‚Üí erstmal null
if (!planId) {
    planId = null;
}

// Referenzen werden sp√§ter gesetzt
let planDocRef = null;
let foodsCollection = null;
let weekPlanRef = null;

function initializePlan(id) {
    planId = id;

    planDocRef = doc(db, "plans", planId);
    foodsCollection = collection(planDocRef, "foods");
    weekPlanRef = doc(planDocRef, "meta", "weekPlan");

    // Echtzeit Sync starten
    onSnapshot(foodsCollection, (snapshot) => {
        foods = [];

        snapshot.forEach((docItem) => {
            foods.push({
                id: docItem.id,
                name: docItem.data().name
            });
        });

        foods.sort((a,b)=> a.name.localeCompare(b.name));
        renderList();
    });

    loadWeekPlan();
}

// Wenn Plan in URL existiert ‚Üí direkt initialisieren
if (planId) {
    initializePlan(planId);
}

let foods = []; // Lokales Array f√ºr alle Gerichte
let weekPlan = {
    Montag: null,
    Dienstag: null,
    Mittwoch: null,
    Donnerstag: null,
    Freitag: null,
    Samstag: null,
    Sonntag: null
};

const daysOrder = [
    "Montag",
    "Dienstag",
    "Mittwoch",
    "Donnerstag",
    "Freitag",
    "Samstag",
    "Sonntag"
];

let searchTerm = ""; // Aktueller Suchbegriff


// Essen hinzuf√ºgen
window.addFood = async function() {

    const input = document.getElementById("foodInput");
    const value = input.value.trim();

    if (value === "") return;

    // Wenn noch kein Plan existiert ‚Üí jetzt erstellen
    if (!planId) {
        const newId = crypto.randomUUID();
        window.history.replaceState(null, "", "?plan=" + newId);
        initializePlan(newId);
    }

    await addDoc(foodsCollection, { name: value });
    showToast("Gericht hinzugef√ºgt ‚úî", "success");

    input.value = "";
};

// Essen l√∂schen
window.removeFood = async function(id) {
    await deleteDoc(doc(db, "plans", planId, "foods", id));
};

// Zufallsgericht ausw√§hlen
window.pickRandomFood = function() {

    if (foods.length === 0) return; // Wenn leer ‚Üí abbrechen

    const randomIndex = Math.floor(Math.random() * foods.length); // Zuf√§lliger Index
    document.getElementById("result").innerText = foods[randomIndex].name; // Anzeigen
};

window.assignRandom = async function(day, event) {

    if (foods.length === 0) return;
    // Button finden und Animation starten
    const button = event.target;
    button.classList.remove("spin");
    void button.offsetWidth;
    button.classList.add("spin");

    // Bereits vergebene Gerichte sammeln
    const usedMeals = Object.values(weekPlan).filter(meal => meal !== null);

    // Nur noch verf√ºgbare Gerichte
    const availableMeals = foods.filter(food =>
        !usedMeals.includes(food.name)
    );

    if (availableMeals.length === 0) {
        showToast("Keine Gerichte mehr verf√ºgbar. Bitte neue Gerichte hinzuf√ºgen", "error");
        return;
    }

    const randomIndex = Math.floor(Math.random() * availableMeals.length);

    weekPlan[day] = availableMeals[randomIndex].name;

        await setDoc(weekPlanRef, weekPlan);

        renderWeekPlan();
        
};

// Plan teilen
window.sharePlan = function() {

    if (!planId) {
        showToast("Bitte zuerst ein Gericht hinzuf√ºgen", "error");
        return;
    }

    const shareUrl = window.location.href;

    document.getElementById("shareLinkInput").value = shareUrl;
    document.getElementById("shareModal").style.display = "flex";
};

window.closeShareModal = function() {
    document.getElementById("shareModal").style.display = "none";
};

window.copyShareLink = async function() {

    const link = document.getElementById("shareLinkInput").value;

    try {
        await navigator.clipboard.writeText(link);
        showToast("‚úî Link kopiert", "success");
    } catch (err) {
        showToast("Kopieren fehlgeschlagen üòÖ", "error");
    }
};

window.resetWeekPlan = async function() {

    weekPlan = {
        Montag: null,
        Dienstag: null,
        Mittwoch: null,
        Donnerstag: null,
        Freitag: null,
        Samstag: null,
        Sonntag: null
    };

    await setDoc(weekPlanRef, weekPlan);
    showToast("Woche zur√ºckgesetzt ‚úî", "success");

    renderWeekPlan();
};

window.switchTab = function(tabName) {

    document.querySelectorAll(".tab").forEach(btn => {
        btn.classList.remove("active");
    });

    document.querySelectorAll(".tab-content").forEach(view => {
        view.classList.remove("active");
    });

    if (tabName === "meals") {
        document.getElementById("mealsView").classList.add("active");
        document.querySelectorAll(".tab")[0].classList.add("active");
    }

    if (tabName === "week") {
        document.getElementById("weekView").classList.add("active");
        document.querySelectorAll(".tab")[1].classList.add("active");
    }
};

document.getElementById("searchInput").addEventListener("input", function(e) {
    searchTerm = e.target.value.toLowerCase();
    renderList();
});

document.getElementById("foodInput").addEventListener("keydown", function(e) {
    if (e.key === "Enter") {
        e.preventDefault();   // verhindert unerw√ºnschtes Verhalten
        addFood();            // ruft deine bestehende Funktion auf
    }
});

function renderList() {

    const container = document.getElementById("foodList");
    container.innerHTML = "";
    updateMealCount();

    const filteredFoods = foods.filter(food =>
        food.name.toLowerCase().includes(searchTerm)
    );

    if (filteredFoods.length === 0) {
        container.innerHTML = "<p>Noch keine Gerichte vorhanden!</p>";
        return;
    }

    // Liste halbieren
    const middle = Math.ceil(filteredFoods.length / 2);
    const leftFoods = filteredFoods.slice(0, middle);
    const rightFoods = filteredFoods.slice(middle);

    const leftColumn = document.createElement("div");
    leftColumn.className = "column";

    const rightColumn = document.createElement("div");
    rightColumn.className = "column";

    function renderColumn(foodArray, column) {

        let currentLetter = "";

        foodArray.forEach(food => {

            const firstLetter = food.name.charAt(0).toUpperCase();

            if (firstLetter !== currentLetter) {
                currentLetter = firstLetter;

                const letter = document.createElement("div");
                letter.className = "letter-heading";
                letter.innerHTML = `
                <div class="letter-label">${currentLetter}</div>
                `;
                column.appendChild(letter);
            }

            const item = document.createElement("div");
            item.className = "food-item";
            item.innerHTML = `
                ${food.name}
                <button class="remove-btn" onclick="removeFood('${food.id}')">X</button>
            `;

            column.appendChild(item);
        });
    }

    renderColumn(leftFoods, leftColumn);
    renderColumn(rightFoods, rightColumn);

    container.appendChild(leftColumn);
    container.appendChild(rightColumn);
}

function renderWeekPlan() {

    const container = document.getElementById("weekPlan");
    container.innerHTML = "";

    daysOrder.forEach(day => {

        const row = document.createElement("div");
        row.className = weekPlan[day] ? "day-row filled" : "day-row";

        row.innerHTML = `
        <div class="day-left">
        <div class="day-name">${day}</div>
        ${weekPlan[day] ? weekPlan[day] : "<span class='empty-meal'>Noch nichts geplant</span>"}
        </div>
        <button class="dice-btn" onclick="assignRandom('${day}', event)">üé≤</button>
        `;

        container.appendChild(row);
    });
    updateWeekCount();
}
async function loadWeekPlan() {

    const docSnap = await getDoc(weekPlanRef);

    if (docSnap.exists()) {
        weekPlan = docSnap.data();
    }

    renderWeekPlan();
}
loadWeekPlan();

function showToast(message, type = "success") {

    const toast = document.getElementById("toast");

    toast.textContent = message;
    toast.className = "toast show " + type;

    setTimeout(() => {
        toast.classList.remove("show");
    }, 3000);
}

function updateMealCount() {

    const badge = document.getElementById("mealCountBadge");
    if (!badge) return;

    const newValue = foods.length.toString();

    if (badge.innerText !== newValue) {

        badge.innerText = newValue;

        badge.classList.remove("bump");
        void badge.offsetWidth; // Reflow erzwingen
        badge.classList.add("bump");

    } else {
        badge.innerText = newValue;
    }
}

function updateWeekCount() {

    const badge = document.getElementById("weekCountBadge");
    if (!badge) return;

    const filledDays = Object.values(weekPlan)
        .filter(meal => meal !== null).length;

    const newValue = filledDays + "/7";

    // Nur animieren, wenn sich der Wert √§ndert
    if (badge.innerText !== newValue) {

        badge.innerText = newValue;

        badge.classList.remove("bump");
        void badge.offsetWidth; // reflow erzwingen
        badge.classList.add("bump");

    } else {
        badge.innerText = newValue;
    }
}

const toggleBtn = document.getElementById("themeToggle");

function applyTheme(theme) {
    if (theme === "dark") {
        document.body.classList.add("dark");
        toggleBtn.textContent = "‚òÄÔ∏è";
    } else {
        document.body.classList.remove("dark");
        toggleBtn.textContent = "üåô";
    }
}

toggleBtn.addEventListener("click", () => {
    const isDark = document.body.classList.contains("dark");
    const newTheme = isDark ? "light" : "dark";

    localStorage.setItem("theme", newTheme);
    applyTheme(newTheme);
});

// gespeichertes Theme laden
applyTheme(localStorage.getItem("theme") || "light");
</script>

</body>
</html>