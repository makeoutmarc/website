<!DOCTYPE html> <!-- HTML5 Dokumenttyp -->
<html lang="de"> <!-- Sprache der Website = Deutsch -->
<head>
<meta charset="UTF-8"> <!-- Zeichencodierung -->
<meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Mobile Optimierung -->
<title>Essensideen</title> <!-- Titel im Browser-Tab -->

<style>

/* =========================
   GRUNDLAYOUT
========================= */

body {
    font-family: Arial, sans-serif; /* Schriftart */
    background: #f5f7fa; /* Hintergrundfarbe */
    display: flex; /* Flexbox aktivieren --> hilft beim zentrieren */
    justify-content: center; /* Inhalt horizontal zentrieren */
    padding: 40px 20px; /* Au√üenabstand */
}

/* Hauptcontainer */
.container {
    background: white; /* Wei√üer Kasten */
    padding: 30px;  /* Innenabstand */
    width: 1000px;  /* Feste Breite */
    border-radius: 12px;    /* Abgerundete Ecken */
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);    /* Schatten */
}

/* √úberschrift */
h1 {
    margin-bottom: 20px; /* Abstand nach unten */
}

/* Eingabefeld */
input {
  width: 100%; /* Volle Breite */
  padding: 10px; /* Innenabstand */
  font-size: 16px; /* Schriftgr√∂√üe */
  border-radius: 6px; /* Runde Ecken */
  border: 1px solid #ccc; /* Rahmen */
  margin-bottom: 15px;/* Abstand nach unten */
  box-sizing: border-box;   /* ‚Üê WICHTIG */
}



/* Buttons allgemein */
button {
    padding: 10px; /* Innenabstand */
    border: none; /* Kein Rahmen */
    border-radius: 6px; /* Runde Ecken */
    cursor: pointer; /* Mauszeiger = Hand */
    font-weight: bold; /* Fettschrift */
    transition: 0.2s ease; /* Hover-Animation */
}




/* Hinzuf√ºgen Button */
.add-btn {
    background: #00b44b; /* Gr√ºn */
    color: white; /* Textfarbe */
    width: 100%; /* Volle Breite */
    margin-bottom: 15px; /* Abstand */
    font-weight: bold;
    font-size: 16px;
}

.add-btn:hover {
    background: #27ae60; /* Dunkleres Gr√ºn bei Hover */
}

/* Zufalls Button */
.random-btn {
    background: #3498db; /* Blau */
    color: white;
    width: 100%;
    margin-top: 15px;
    font-weight: bold;
    font-size: 16px;
}

.random-btn:hover {
    background: #2980b9; /* Dunkler bei Hover */
}

.container {
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}

.day-row {
    display: flex;
    align-items: center;
    gap: 10px;

    border: 1px solid #000000;   /* Rahmen */
    padding: 8px 10px;           /* Innenabstand */
    border-radius: 6px;          /* Runde Ecken */
    /*Abstand zu rand rechts*/
    margin-bottom: 10px; /* Abstand nach unten */
}

.day-row span {
    flex: 1;
}

.day-row button {
    width: 30px;
    height: 30px;
    padding: 0;
    font-size: 14px;
}

.section-divider {
    margin: 30px 0;
    border: none;
    height: 1px;
    background: rgba(0,0,0,0.15);
}



/* Liste */

ul {
    list-style: none;
    padding: 0;
    margin: 0;

    column-gap: 40px;      /* Abstand */
}

/* Einzelnes Essen */
.food-item {
    background: #e4e4e4; /* Heller Hintergrund */
    border: 1px solid #000000;  /* D√ºnner schwarzer Rahmen um die K√§stchen drum rum */
    padding: 10px;  /* Innenabstand */
    margin-bottom: 8px; /* Abstand nach unten */
    border-radius: 6px; /* Runde Ecken */
    display: flex; /* Flexbox aktivieren */
    justify-content: space-between; /* Abstand zwischen Text & Button */
    align-items: center; /* Vertikal zentrieren */
    break-inside: avoid;   /* Verhindert Umbruch mitten im Element */
}

/* Entfernen Button */
.remove-btn {
    background: rgb(240, 59, 59); /* Rot */
    color: white; /* Textfarbe */
    width: 20px;    /* Quadratisch */
    height: 20px;   /* Quadratisch */
    padding: 0;     /* Kein Innenabstand, damit Text zentriert */                  
    font-size: 16px; /* Kleine Schrift, damit es in den Button passt */
    line-height: 1; /* Zeilenh√∂he anpassen, damit Text vertikal zentriert ist */
    border-radius: 50%; /* Runde Form */
    display: flex;              /* ‚Üê macht echtes Zentrieren */
    justify-content: center; /* Horizontal zentrieren */
    align-items: center; /* Vertikal zentrieren */
}

.remove-btn:hover {
    background: darkred; /* Hover-Effekt */
}

.grid-container {
    display: grid;
    grid-template-columns: 1fr 1fr; /* 2 Spalten mit gleicher Breite */
    gap: 40px;
}

.column {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.letter-heading {
    margin-top: 15px;
}

/* Zufallsergebnis */
#result {
    font-size: 16px; /* Gro√üe Schrift */
    font-weight: bold;
    margin-top: 15px;
}

#foodList {
    display: grid;
    grid-template-columns: 1fr 1fr; /* 2 Spalten mit gleicher Breite */
    gap: 40px;
}

#weekPlan {
    margin-top: 15px;
}

.column {
    display: flex;
    flex-direction: column;
}

.reset-btn {
    background: #f39c12;
    color: white;
    margin-bottom: 15px;
}

.reset-btn:hover {
    background: #e67e22;
}

</style>
</head>

<body>

<div class="container">

    <h1>Essensideen</h1>

    <input type="text" id="foodInput" placeholder="Neues Essen hinzuf√ºgen">
    <button class="add-btn" onclick="addFood()">Hinzuf√ºgen</button>

    <input type="text" id="searchInput" placeholder="Gericht suchen...">

    <div id="foodList"></div>

    <button class="random-btn" onclick="pickRandomFood()">Zuf√§lliges Gericht ausw√§hlen</button>

    <div id="result"></div>

    <!-- Trennlinie -->
    <hr class="section-divider">

    <h2>Wochenplan</h2>
    
    <button class="reset-btn" onclick="resetWeekPlan()">Woche zur√ºcksetzen</button>

    <div id="weekPlan"></div>

</div>

<script type="module"> 

// Firebase Imports (Module aus Firebase laden)
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { 
    getFirestore,
    collection,
    addDoc,
    deleteDoc,
    doc,
    onSnapshot,
    setDoc,
    getDoc
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

// Firebase Config (Verbindungsdaten zu deinem Projekt)
const firebaseConfig = {
    apiKey: "AIza...",
    authDomain: "website-essen.firebaseapp.com",
    projectId: "website-essen",
    storageBucket: "website-essen.firebasestorage.app",
    messagingSenderId: "95662683991",
    appId: "1:95662683991:web:0bc5891b804db149647012"
};

// Firebase starten
const app = initializeApp(firebaseConfig); // App initialisieren
const db = getFirestore(app); // Firestore Datenbank starten
const foodsCollection = collection(db, "foods"); // Referenz zur Collection "foods"
const weekPlanRef = doc(db, "settings", "weekPlan");

let foods = []; // Lokales Array f√ºr alle Gerichte
let weekPlan = {
    Montag: null,
    Dienstag: null,
    Mittwoch: null,
    Donnerstag: null,
    Freitag: null,
    Samstag: null,
    Sonntag: null
};

const daysOrder = [
    "Montag",
    "Dienstag",
    "Mittwoch",
    "Donnerstag",
    "Freitag",
    "Samstag",
    "Sonntag"
];

let searchTerm = ""; // Aktueller Suchbegriff

// Echtzeit Sync: Wird automatisch ausgel√∂st wenn sich Daten √§ndern
onSnapshot(foodsCollection, (snapshot) => {

    foods = []; // Array leeren

    snapshot.forEach((docItem) => { // Jedes Dokument durchgehen
        foods.push({
            id: docItem.id, // Dokument-ID speichern
            name: docItem.data().name // Name speichern
        });
    });

    foods.sort((a,b)=> a.name.localeCompare(b.name)); // Alphabetisch sortieren
    renderList(); // Liste neu anzeigen
});

// Essen hinzuf√ºgen
window.addFood = async function() {

    const input = document.getElementById("foodInput"); // Eingabefeld holen
    const value = input.value.trim(); // Text holen und Leerzeichen entfernen

    if (value === "") return; // Wenn leer ‚Üí abbrechen

    await addDoc(foodsCollection, { name: value }); // Neues Dokument speichern

    input.value = ""; // Eingabefeld leeren
};

// Essen l√∂schen
window.removeFood = async function(id) {
    await deleteDoc(doc(db, "foods", id)); // Dokument anhand ID l√∂schen
};

// Zufallsgericht ausw√§hlen
window.pickRandomFood = function() {

    if (foods.length === 0) return; // Wenn leer ‚Üí abbrechen

    const randomIndex = Math.floor(Math.random() * foods.length); // Zuf√§lliger Index
    document.getElementById("result").innerText = foods[randomIndex].name; // Anzeigen
};

window.assignRandom = async function(day) {

    if (foods.length === 0) return;

    // Bereits vergebene Gerichte sammeln
    const usedMeals = Object.values(weekPlan).filter(meal => meal !== null);

    // Nur noch verf√ºgbare Gerichte
    const availableMeals = foods.filter(food =>
        !usedMeals.includes(food.name)
    );

    if (availableMeals.length === 0) {
        alert("Keine Gerichte mehr verf√ºgbar üòÖ");
        return;
    }

    const randomIndex = Math.floor(Math.random() * availableMeals.length);

    weekPlan[day] = availableMeals[randomIndex].name;

        await setDoc(weekPlanRef, weekPlan);

        renderWeekPlan();
};

window.resetWeekPlan = async function() {

    weekPlan = {
        Montag: null,
        Dienstag: null,
        Mittwoch: null,
        Donnerstag: null,
        Freitag: null,
        Samstag: null,
        Sonntag: null
    };

    await setDoc(weekPlanRef, weekPlan);

    renderWeekPlan();
};

document.getElementById("searchInput").addEventListener("input", function(e) {
    searchTerm = e.target.value.toLowerCase();
    renderList();
});

// Liste neu aufbauen
/* function renderList() {

    const list = document.getElementById("foodList"); // UL holen
    list.innerHTML = ""; // Alte Liste l√∂schen

    foods.forEach((food) => { // Jedes Essen durchgehen

        const li = document.createElement("li"); // Neues Listenelement erstellen
        li.className = "food-item"; // CSS Klasse setzen

        li.innerHTML = `
            ${food.name}
            <button class="remove-btn" onclick="removeFood('${food.id}')">‚àí</button>
        `; // Inhalt setzen

        list.appendChild(li); // Element zur Liste hinzuf√ºgen
    });
} */

function renderList() {

    const container = document.getElementById("foodList");
    container.innerHTML = "";

    const filteredFoods = foods.filter(food =>
        food.name.toLowerCase().includes(searchTerm)
    );

    if (filteredFoods.length === 0) {
        container.innerHTML = "<p>Noch keine Gerichte vorhanden!</p>";
        return;
    }

    // Liste halbieren
    const middle = Math.ceil(filteredFoods.length / 2);
    const leftFoods = filteredFoods.slice(0, middle);
    const rightFoods = filteredFoods.slice(middle);

    const leftColumn = document.createElement("div");
    leftColumn.className = "column";

    const rightColumn = document.createElement("div");
    rightColumn.className = "column";

    function renderColumn(foodArray, column) {

        let currentLetter = "";

        foodArray.forEach(food => {

            const firstLetter = food.name.charAt(0).toUpperCase();

            if (firstLetter !== currentLetter) {
                currentLetter = firstLetter;

                const letter = document.createElement("div");
                letter.innerHTML = `<strong>${currentLetter}</strong><hr>`;
                column.appendChild(letter);
            }

            const item = document.createElement("div");
            item.className = "food-item";
            item.innerHTML = `
                ${food.name}
                <button class="remove-btn" onclick="removeFood('${food.id}')">X</button>
            `;

            column.appendChild(item);
        });
    }

    renderColumn(leftFoods, leftColumn);
    renderColumn(rightFoods, rightColumn);

    container.appendChild(leftColumn);
    container.appendChild(rightColumn);
}

function renderWeekPlan() {

    const container = document.getElementById("weekPlan");
    container.innerHTML = "";

    daysOrder.forEach(day => {

        const row = document.createElement("div");
        row.className = "day-row";

        row.innerHTML = `
            <span><strong>${day}</strong></span>
            <button onclick="assignRandom('${day}')">üé≤</button>
            <span>${weekPlan[day] || "-"}</span>
        `;

        container.appendChild(row);
    });
}
async function loadWeekPlan() {

    const docSnap = await getDoc(weekPlanRef);

    if (docSnap.exists()) {
        weekPlan = docSnap.data();
    }

    renderWeekPlan();
}
loadWeekPlan();
</script>

</body>
</html>
